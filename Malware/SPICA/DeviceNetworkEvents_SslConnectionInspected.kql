//Detection of connections using known bad certification information. Add/remove malicious certificate subject names within the below let statement to modify query. 
let subjects = dynamic(["cache-dns",
"cache-dns-forwarding",
"cache-dns-preview",
"cache-docs",
"cache-pdf",
"cache-pdf",
"cache-services",
"cloud-docs",
"cloud-drive",
"cloud-storage",
"docs-cache",
"docs-forwarding",
"docs-info",
"docs-shared",
"docs-shared",
"docs-view",
"document-forwarding",
"document-online",
"document-preview",
"documents-cloud",
"documents-cloud",
"documents-forwarding",
"document-share",
"documents-online",
"documents-pdf",
"documents-preview",
"documents-view",
"document-view",
"drive-docs",
"drive-share",
"goo-link",
"hypertextteches",
"mail-docs",
"officeonline365",
"online365-office",
"online-document",
"online-storage",
"pdf-cache",
"pdf-cache",
"pdf-docs",
"pdf-forwarding",
"protection-checklinks",
"protection-link",
"protectionmail",
"protection-office",
"protect-link",
"proton-docs",
"proton-reader",
"proton-viewer",
"relogin-dashboard",
"safe-connection",
"safelinks-protect",
"secureoffice",
"webresources",
"word-yand",
"yandx-online",
"y-ml",
"docs-drive",
"docs-info",
"cloud-mail",
"onlinecloud365",
"pdf-cloud",
"pdf-shared",
"proton-pdf",
"proton-view",
"office365-online",
"doc-viewer",
"file-milgov",
"office-protection"]);
DeviceNetworkEvents
| where ActionType =~ "sslconnectioninspected"
| mv-expand todynamic(AdditionalFields)
| extend subject_field = AdditionalFields.subject
| where subject_field has_any (subjects)
