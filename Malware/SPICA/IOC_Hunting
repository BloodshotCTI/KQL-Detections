let filename_ioc = dynamic([]);
let hash_ioc = dynamic(["0f6b9d2ada67cebc8c0f03786c442c61c05cef5b92641ec4c1bdd8f5baeb2ee1", "A949ec428116489f5e77cefc67fea475017e0f50d2289e17c3eb053072adcf24", "C97acea1a6ef59d58a498f1e1f0e0648d6979c4325de3ee726038df1fc2e831d", "Ac270310b5410e7430fe7e36a079525cd8724b002b38e13a6ee6e09b326f4847", "84523ddad722e205e2d52eedfb682026928b63f919a7bf1ce6f1ad4180d0f507", "37c52481711631a5c73a6341bd8bea302ad57f02199db7624b580058547fb5a9", "C97acea1a6ef59d58a498f1e1f0e0648d6979c4325de3ee726038df1fc2e831d"]);
let domain_ioc = dynamic(["cache-dns.com","cache-dns-forwarding.com","cache-dns-preview.com","cache-docs.com","cache-pdf.com","cache-pdf.online","cache-services.live","cloud-docs.com","cloud-drive.live","cloud-storage.live","docs-cache.com","docs-forwarding.online","docs-info.com","docs-shared.com","docs-shared.online","docs-view.online","document-forwarding.com","document-online.live","document-preview.com","documents-cloud.com","documents-cloud.online","documents-forwarding.com","document-share.live","documents-online.live","documents-pdf.online","documents-preview.com","documents-view.live","document-view.live","drive-docs.com","drive-share.live","goo-link.online","hypertextteches.com","mail-docs.online","officeonline365.live","online365-office.com","online-document.live","online-storage.live","pdf-cache.com","pdf-cache.online","pdf-docs.online","pdf-forwarding.online","protection-checklinks.xyz","protection-link.online","protectionmail.online","protection-office.live","protect-link.online","proton-docs.com","proton-reader.com","proton-viewer.com","relogin-dashboard.online","safe-connection.online","safelinks-protect.live","secureoffice.live","webresources.live","word-yand.live","yandx-online.cloud","y-ml.co","docs-drive.online","docs-info.online","cloud-mail.online","onlinecloud365.live","pdf-cloud.online","pdf-shared.online","proton-pdf.online","proton-view.online","office365-online.live","doc-viewer.com","file-milgov.systems","office-protection.online"]);
let ip_ioc = dynamic(["192.3.193.146","172.245.163.141","198.46.129.163","194.213.18.101","198.46.173.141","172.245.119.67","91.236.230.10","198.46.177.144","192.210.214.18","198.12.123.23","172.245.214.72","104.168.33.24","192.3.239.2","192.3.223.37","192.3.26.148","23.94.80.242","194.213.18.162","185.251.89.101","198.46.176.159","198.46.176.151","185.251.88.84","192.3.26.147","198.46.129.161","107.174.212.72","45.66.248.141","172.245.214.67","198.12.124.84","172.245.119.67","198.23.212.246","198.46.177.144","192.3.141.176"]);
(union isfuzzy=true
(EmailEvents
| where Timestamp >= ago(30d)
| where SenderIPv4 in (ip_ioc) or SenderFromDomain has_any (domain_ioc)
),
(EmailAttachmentInfo
| where Timestamp >= ago(30d)
| where FileName has_any (filename_ioc) or SenderFromAddress in (ip_ioc)
),
(DeviceNetworkEvents
| where Timestamp >= ago(30d)
| where RemoteIP in (ip_ioc) or InitiatingProcessSHA256 in (hash_ioc) or InitiatingProcessMD5 in (hash_ioc) or InitiatingProcessSHA1 in (hash_ioc)
),
(DeviceFileEvents
| where Timestamp >= ago(30d)
| where FileOriginIP in (ip_ioc) or FileName in (filename_ioc) or SHA1 in (hash_ioc) or SHA256 in (hash_ioc) or MD5 in (hash_ioc) or FileOriginUrl has_any (domain_ioc)
),
(DeviceEvents
| where Timestamp >= ago(30d)
| where FileOriginIP in (ip_ioc) or RemoteIP in (ip_ioc) or FileName in (filename_ioc) or SHA1 in (hash_ioc) or SHA256 in (hash_ioc) or MD5 in (hash_ioc) or FileOriginUrl has_any (domain_ioc)
),
(DeviceRegistryEvents
| where Timestamp >= ago(30d)
| where InitiatingProcessSHA256 in (hash_ioc) or InitiatingProcessMD5 in (hash_ioc) or InitiatingProcessSHA1 in (hash_ioc)
)
)
